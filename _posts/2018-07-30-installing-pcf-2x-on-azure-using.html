---
layout: post
title: Installing PCF 2.X  on Azure using Concourse - Part - 1 , Bosh Boot loader  and
  bosh
date: '2018-07-30T23:36:00.000-07:00'
author: Anand Rao
tags:
- Pivotal Cloud Foundry
- PCF
- Cloud Foundry
modified_time: '2018-08-09T23:17:34.563-07:00'
thumbnail: https://3.bp.blogspot.com/-DR6Sw2iG6Ec/W1_9xAoc3EI/AAAAAAAAGIk/KXhOFGxUZPsoV1d5CtyxDEsCrqkqvdOZwCLcBGAs/s72-c/post-bbl-up-resource-group.png
blogger_id: tag:blogger.com,1999:blog-3696969976504014907.post-55314962503204051
blogger_orig_url: https://blog.clue2solve.io/2018/07/installing-pcf-2x-on-azure-using.html
---

<b>PCF on Azure with Platform Automation using PCF-Pipelines</b> - <b>PART 1</b><br /><br />Thats a loaded set of words. Many of our customers at Pivotal have started looking at Data Center augmentation, specially for burst needs using a public IAAS provider like AWS , GCP and Azure. In this edition of my blog , I wanted to go over the process of installing a full Pivotal Cloud Foundry Foundation.&nbsp; Even though we at Pivotal provide detail instructions for a manual install of the foundation,&nbsp; automation has always been a big need.<br /><br /><b><u>Concourse and Platform Automation</u></b><br />Concourse is the CI tool developed at Pivotal for all our automation needs during the Cloud foundry development. With the mindset of treating "<b>Platform as a Product</b>" and also <b>eating our own dogfood</b>&nbsp;( Wait ,&nbsp; should I say "<b>drinking our own champagne</b>"), we have a new product slug called PCF-Pipelines. It is a opinionated set of pipelines that help automate the whole process of installing, upgrading and maintaining all the tiles on the platform.<br /><b><u><br /></u></b> <b><u>About the Trail&nbsp;</u></b><br />Having gone through the install journey as I prep to work with multiple customers,&nbsp; I thought I will throw the breadcrumbs to help document the Trail! In Part 1 of this multipart&nbsp; blog, I will focus on installing bosh via bosh boot loader. I will come back and talk about installing and configuring concourse with a couple simple examples to see it working and&nbsp; PCF installation using the pipelines on subsequent blogs.<br /><br />Lets install a copy of bosh that will control concourse and a jumpbox to access the components installed.<br /><br />The <a href="https://github.com/cloudfoundry/bosh-bootloader" target="_blank">BBL docs</a> explains how to do this for aws, azure and gcp.&nbsp; I have picked up the info needed for azure below.<br /><ol><li>Install bbl ( the boot loader )&nbsp;</li><pre><code><br /><span style="background-color: #f3f3f3;">$<i> brew tap cloudfoundry/tap<br />$ brew install bosh-cli<br />$ brew install bbl</i></span><br /></code><br /></pre><li>&nbsp;Setup the Environment variables via a .PS1 file as below to allow easy reuse.&nbsp;</li><pre><code>(change the value that says "CHANGEME" to real values based on your IAAS info)</code></pre><pre><code><br /><i style="background-color: #f3f3f3;">anandrao at Anands-MBP in ~/pivotal/repos/bbl-az<br />$ cat bbl-az-variables.PS1<br />export BBL_IAAS=azure<br />export BBL_AZURE_CLIENT_ID="<b>CHANGEME</b>"<br />export BBL_AZURE_CLIENT_SECRET="<b>CHANGEME</b>"<br />export BBL_AZURE_REGION=westus<br />export BBL_AZURE_SUBSCRIPTION_ID="<b>CHANGEME</b>"<br />export BBL_AZURE_TENANT_ID=</i></code><i style="background-color: #f3f3f3;">"<b>CHANGEME</b>"</i></pre><pre><code><br /></code></pre><li>Execute the below commands to setup your Bosh along with a jumpbox and yea a load balancer as well. "bbl" does it all in one command.&nbsp; ( I would create a folder and run bbl inside that as&nbsp; all the files bbl creates will be clearly in one distinct place).<br /><br /><pre><code><br /><span style="background-color: #f3f3f3;"><i>anandrao at Anands-MBP in ~/pivotal/repos/bbl-az<br />$ mkdir bbl ; cd bbl<br /><br />anandrao at Anands-MBP in ~/pivotal/repos/bbl-az/bbl<br />$ bbl plan<br />step: generating terraform template<br />step: generating terraform variables<br />step: terraform init</i><br /><br /><br /></span><i><span style="background-color: #f3f3f3;">anandrao at Anands-MBP in ~/pivotal/repos/bbl-az/bbl<br />$ bbl up<br />step: terraform init<br />step: terraform apply<br />step: creating jumpbox<br />Deployment manifest: '/Users/anandrao/pivotal/repos/bbl-az/bbl/jumpbox-deployment/jumpbox.yml'<br />Deployment state: '/Users/anandrao/pivotal/repos/bbl-az/bbl/vars/jumpbox-state.json'<br /><br />Started validating<br />  Downloading release 'os-conf'... Skipped [Found in local cache] (00:00:00)<br />  Validating release 'os-conf'... Finished (00:00:00)<br />  Downloading release 'bosh-azure-cpi'... Skipped [Found in local cache] (00:00:00)<br />  Validating release 'bosh-azure-cpi'... Finished (00:00:00)<br />  Validating cpi release... Finished (00:00:00)<br />  Validating deployment manifest... Finished (00:00:00)<br />  Downloading stemcell... Skipped [Found in local cache] (00:00:00)<br />  Validating stemcell... Finished (00:00:01)<br />Finished validating (00:00:01)<br /><br />Started installing CPI<br />  Compiling package 'ruby-2.4-r3/8471dec5da9ecc321686b8990a5ad2cc84529254'... Finished (00:02:33)<br />  Compiling package 'bosh_azure_cpi/ceb90b730e4e350787d1be2b81bb97b433549f3f'... Finished (00:01:01)<br />  Installing packages... Finished (00:00:00)<br />  Rendering job templates... Finished (00:00:00)<br />  Installing job 'azure_cpi'... Finished (00:00:00)<br />Finished installing CPI (00:03:36)<br /><br />Starting registry... Finished (00:00:00)<br />Uploading stemcell 'bosh-azure-hyperv-ubuntu-trusty-go_agent/3468.17'... Finished (00:01:42)<br /><br />Started deploying<br />  Creating VM for instance 'jumpbox/0' from stemcell 'bosh-stemcell-b6c82a4f-e14f-4ef9-91f6-f21339fc0b15'... Finished (00:01:36)<br />  Waiting for the agent on VM 'agent_id:22df9d2e-e05d-4ae6-5f5f-622d66debf6d;resource_group_name:bbl-env-ontario-2018-07-31t05-15z-bosh;storage_account_name:bblenvontario2018073jfde' to be ready... Finished (00:00:25)<br />  Rendering job templates... Finished (00:00:00)<br />  Updating instance 'jumpbox/0'... Finished (00:00:12)<br />  Waiting for instance 'jumpbox/0' to be running... Finished (00:00:00)<br />  Running the post-start scripts 'jumpbox/0'... Finished (00:00:00)<br />Finished deploying (00:02:21)<br /><br />Stopping registry... Finished (00:00:00)<br />Cleaning up rendered CPI jobs... Finished (00:00:00)<br /><br />Succeeded<br />step: created jumpbox<br />step: creating bosh director<br />Deployment manifest: '/Users/anandrao/pivotal/repos/bbl-az/bbl/bosh-deployment/bosh.yml'<br />Deployment state: '/Users/anandrao/pivotal/repos/bbl-az/bbl/vars/bosh-state.json'<br /><br />Started validating<br />  Downloading release 'bosh'... Finished (00:00:08)<br />  Validating release 'bosh'... Finished (00:00:00)<br />  Downloading release 'bpm'... Finished (00:00:11)<br />  Validating release 'bpm'... Finished (00:00:00)<br />  Downloading release 'bosh-azure-cpi'... Finished (00:00:05)<br />  Validating release 'bosh-azure-cpi'... Finished (00:00:00)<br />  Downloading release 'os-conf'... Skipped [Found in local cache] (00:00:00)<br />  Validating release 'os-conf'... Finished (00:00:00)<br />  Downloading release 'uaa'... Finished (00:01:16)<br />  Validating release 'uaa'... Finished (00:00:00)<br />  Downloading release 'credhub'... Finished (00:00:15)<br />  Validating release 'credhub'... Finished (00:00:00)<br />  Validating cpi release... Finished (00:00:00)<br />  Validating deployment manifest... Finished (00:00:00)<br />  Downloading stemcell... Finished (00:00:47)<br />  Validating stemcell... Finished (00:00:01)<br />Finished validating (00:02:52)<br /><br />Started installing CPI<br />  Compiling package 'ruby-2.4-r3/8471dec5da9ecc321686b8990a5ad2cc84529254'... Finished (00:02:30)<br />  Compiling package 'bosh_azure_cpi/e83f4474b88d5f34304ce99a0e1cead2e2ae3627'... Finished (00:01:03)<br />  Installing packages... Finished (00:00:00)<br />  Rendering job templates... Finished (00:00:00)<br />  Installing job 'azure_cpi'... Finished (00:00:00)<br />Finished installing CPI (00:03:35)<br /><br />Starting registry... Finished (00:00:00)<br />Uploading stemcell 'bosh-azure-hyperv-ubuntu-trusty-go_agent/3586.24'... Finished (00:01:36)<br /><br />Started deploying<br />  Creating VM for instance 'bosh/0' from stemcell 'bosh-stemcell-c37f79e2-8cbc-459f-b2c7-8f099707ef8d'... Finished (00:02:38)<br />  Waiting for the agent on VM 'agent_id:7d2deaab-d7db-4adf-711d-f05f3adbfff2;resource_group_name:bbl-env-ontario-2018-07-31t05-15z-bosh;storage_account_name:bblenvontario2018073jfde' to be ready... Finished (00:00:24)<br />  Creating disk... Finished (00:00:36)<br />  Attaching disk 'caching:None;disk_name:bosh-data-9d98f6ea-399c-41b1-888c-86439cf86100;storage_account_name:bblenvontario2018073jfde' to VM 'agent_id:7d2deaab-d7db-4adf-711d-f05f3adbfff2;resource_group_name:bbl-env-ontario-2018-07-31t05-15z-bosh;storage_account_name:bblenvontario2018073jfde'... Finished (00:01:06)<br />  Rendering job templates... Finished (00:00:11)<br />  Compiling package 'ruby-2.4-r4/0cdc60ed7fdb326e605479e9275346200af30a25'... Skipped [Package already compiled] (00:00:00)<br />  Compiling package 'mysql/898f50dde093c366a644964ccb308a5281c226de'... Skipped [Package already compiled] (00:00:00)<br />  Compiling package 'libpq/e2414662250d0498c194c688679661e09ffaa66e'... Skipped [Package already compiled] (00:00:00)<br />  Compiling package 'bpm-runc/c0b41921c5063378870a7c8867c6dc1aa84e7d85'... Skipped [Package already compiled] (00:00:00)<br />  Compiling package 'golang/e3ca1c9440c29ad576d633e9ef6a2f7805a5e8b7'... Skipped [Package already compiled] (00:00:07)<br />  Compiling package 'ruby-2.4-r3/8471dec5da9ecc321686b8990a5ad2cc84529254'... Finished (00:02:12)<br />  Compiling package 'openjdk_1.8.0/c8846344bf802835ce8b1229de8fa2028d06f603'... Skipped [Package already compiled] (00:00:02)<br />  Compiling package 'golang-1.9-linux/8d6c67abda8684ce454f0bc74050a213456573ff'... Skipped [Package already compiled] (00:00:06)<br />  Compiling package 'gonats/73ec55f11c24dd7c02288cdffa24446023678cc2'... Skipped [Package already compiled] (00:00:00)<br />  Compiling package 's3cli/3097f27cb9356172c9ae52de945821c4e338c87a'... Skipped [Package already compiled] (00:00:00)<br />  Compiling package 'uaa/cdb6217bd1b700002b9746c0b069d79480edb192'... Skipped [Package already compiled] (00:00:09)<br />  Compiling package 'verify_multidigest/8fc5d654cebad7725c34bb08b3f60b912db7094a'... Skipped [Package already compiled] (00:00:00)<br />  Compiling package 'registry/a6daac4743749c70c2ae15e58170adb6b41a3a76'... Skipped [Package already compiled] (00:00:01)<br />  Compiling package 'health_monitor/251915bca2d42f06f4bbb1f5395afd1ae73cf681'... Skipped [Package already compiled] (00:00:00)<br />  Compiling package 'director/db07ae48ea2963a9cdec4938a9522f85f718e672'... Skipped [Package already compiled] (00:00:01)<br />  Compiling package 'postgres-9.4/52b3a31d7b0282d342aa7a0d62d8b419358c6b6b'... Skipped [Package already compiled] (00:00:00)<br />  Compiling package 'bosh-gcscli/fce60f2d82653ea7e08c768f077c9c4a738d0c39'... Skipped [Package already compiled] (00:00:00)<br />  Compiling package 'bpm/3fe49cfa0140be3ebd8da4bdcadfa6b84d847e87'... Skipped [Package already compiled] (00:00:00)<br />  Compiling package 'lunaclient/b922e045db5246ec742f0c4d1496844942d6167a'... Skipped [Package already compiled] (00:00:00)<br />  Compiling package 'bosh_azure_cpi/e83f4474b88d5f34304ce99a0e1cead2e2ae3627'... Finished (00:00:46)<br />  Compiling package 'uaa_utils/90097ea98715a560867052a2ff0916ec3460aabb'... Skipped [Package already compiled] (00:00:00)<br />  Compiling package 'nginx/d9f726bf0c5a38bad988e40cefb084c821e333cf'... Skipped [Package already compiled] (00:00:00)<br />  Compiling package 'credhub/e3d60a289d5fd414e29ee06e7e5f1a6b3802c792'... Skipped [Package already compiled] (00:00:04)<br />  Compiling package 'configurator/0d632a3a9b06f3777bea07d61807ca06ece24dee'... Skipped [Package already compiled] (00:00:00)<br />  Compiling package 'davcli/f8a86e0b88dd22cb03dec04e42bdca86b07f79c3'... Skipped [Package already compiled] (00:00:00)<br />  Updating instance 'bosh/0'... Finished (00:01:48)<br />  Waiting for instance 'bosh/0' to be running... Finished (00:02:09)<br />  Running the post-start scripts 'bosh/0'... Finished (00:00:20)<br />Finished deploying (00:13:02)<br /><br />Stopping registry... Finished (00:00:00)<br />Cleaning up rendered CPI jobs... Finished (00:00:00)<br /><br />Succeeded<br />step: created bosh director<br />step: generating cloud config<br />step: applying cloud config</span><span style="background-color: #cccccc;"><br /></span></i><br /></code></pre>Very cool , you just installed bosh ,&nbsp; a jump host built with all the security and controls.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</li><li>Lets inspect what we just installed and verify it. "bbl" has a few options that help in verification..<br /><pre><code><br /><span style="background-color: #eeeeee;">Environmental Detail Commands: Useful for automation and gaining access<br />  jumpbox-address         Prints BOSH jumpbox address<br />  director-address        Prints BOSH director address<br />  director-username       Prints BOSH director username<br />  director-password       Prints BOSH director password<br />  director-ca-cert        Prints BOSH director CA certificate<br />  env-id                  Prints environment ID<br />  ssh-key                 Prints jumpbox SSH private key<br />  director-ssh-key        Prints director SSH private key<br />  lbs                     Prints load balancer(s) and DNS records<br />  outputs                 Prints the outputs from terraform<br />  ssh                     Opens an SSH connection to the director or jumpbox<br /><br />anandrao at Anands-MBP in ~/pivotal/repos/bbl-az/bbl<br />$ bbl director-address<br />https://10.0.0.6:25555<br /><br />anandrao at Anands-MBP in ~/pivotal/repos/bbl-az/bbl<br />$ bbl director-username<br />admin.<table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><br /><tr><td style="text-align: center;"><a href="https://3.bp.blogspot.com/-DR6Sw2iG6Ec/W1_9xAoc3EI/AAAAAAAAGIk/KXhOFGxUZPsoV1d5CtyxDEsCrqkqvdOZwCLcBGAs/s1600/post-bbl-up-resource-group.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img alt="Azure Portal View" border="0" data-original-height="983" data-original-width="1600" height="245" src="https://3.bp.blogspot.com/-DR6Sw2iG6Ec/W1_9xAoc3EI/AAAAAAAAGIk/KXhOFGxUZPsoV1d5CtyxDEsCrqkqvdOZwCLcBGAs/s400/post-bbl-up-resource-group.png" title="Azure Portal View " width="400" /></a></td></tr><br /><tr><td class="tr-caption" style="text-align: center;">Azure Portal View</td></tr><br /></tbody></table><br /></span><br /></code></pre></li><li>Lets run some bosh commands and check the environment. The first step I do after the install is extract all the exports commands provided by the "print-env" option of bbl. This will allow you to use bosh and other components installed ( bosh , credhub and the jumpbox). I would inspect the output of the "bbl print-env" .<br /><pre><code><br /><i style="background-color: #f3f3f3;">anandrao at Anands-MBP in ~/pivotal/repos/bbl-az/bbl<br />$ <b>bbl print-env &gt; bbl-all-exports.PS1</b><br /><br />anandrao at Anands-MBP in ~/pivotal/repos/bbl-az/bbl<br />$ source bbl-all-exports.PS1<br /><br />anandrao at Anands-MBP in ~/pivotal/repos/bbl-az/bbl<br />$ bosh vms<br />Using environment 'https://10.0.0.6:25555' as client 'admin'<br /><br />Succeeded<br /><br />anandrao at Anands-MBP in ~/pivotal/repos/bbl-az/bbl<br />$ bosh environment<br />Using environment 'https://10.0.0.6:25555' as client 'admin'<br /><br />Name      bosh-bbl-env-ontario-2018-07-31t05-15z<br />UUID      a03916c8-01f1-4cc2-abe5-93a546e86b79<br />Version   266.4.0 (00000000)<br />CPI       azure_cpi<br />Features  compiled_package_cache: disabled<br />          config_server: enabled<br />          dns: disabled<br />          snapshots: disabled<br />User      admin<br /><br />Succeeded</i><br /></code></pre></li>I would inspect some of the folders created under the bbl folder. You will see the bosh manifests created for the vms created as part of the bbl based install.</ol><div><br /></div><div>Now that we have bosh up and running,&nbsp; we could try out all of our typical bosh commands. Please refer to the bosh cli docs for this.&nbsp;</div><div><br /></div><div>I will jump into <a href="http://blog.clue2solve.io/2018/07/installing-pcf-2x-on-azure-using_31.html" target="_blank">installing concourse</a> as our next step in this journey.<br /><br /><div class="separator" style="clear: both;">Quick links to the "The PCF on Azure" Blog Series :&nbsp;</div><ul><li><a href="http://blog.clue2solve.io/2018/07/installing-pcf-2x-on-azure-using.html">Installing PCF 2.X on Azure using Concourse - Part - 1 , Bosh Boot loader and bosh</a></li><li><a href="http://blog.clue2solve.io/2018/07/installing-pcf-2x-on-azure-using_31.html">Installing PCF 2.X on Azure using Concourse - Part - 2 , Concourse using bosh</a></li><li><a href="http://blog.clue2solve.io/2018/08/installing-pcf-2x-on-azure-using.html">Installing PCF 2.X on Azure using Concourse - Part - 3 , Installing Pivotal Cloud Foundry using a Pipeline</a></li><li><a href="http://blog.clue2solve.io/2018/07/domain-name-system-dns-delegation-with.html">Domain Name System (DNS) Delegation with Azure DNS Zones</a></li><li><a href="http://blog.clue2solve.io/2018/08/cleanup-azure-pcf-install-using-bbl.html">Cleanup Azure PCF install using BBL</a></li></ul></div><br />