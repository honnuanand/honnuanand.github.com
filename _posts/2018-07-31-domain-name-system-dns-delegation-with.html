---
layout: post
title: Domain Name System (DNS) Delegation with Azure DNS Zones
date: '2018-07-31T09:13:00.000-07:00'
author: Anand Rao
tags:
- Pivotal Cloud Foundry
- PCF
- Cloud Foundry
modified_time: '2018-08-09T23:18:14.707-07:00'
thumbnail: https://2.bp.blogspot.com/-YP_tMwEA-sA/W2CD50WNLVI/AAAAAAAAGI8/TIZK4ILshS4VGyk8Zo464jur_uj6zUclACLcBGAs/s72-c/Azure-DNS-Zone%2BSample.png
blogger_id: tag:blogger.com,1999:blog-3696969976504014907.post-3781832666340295440
blogger_orig_url: https://blog.clue2solve.io/2018/07/domain-name-system-dns-delegation-with.html
---

<br />In a lot of our cloud related journeys, Managing DNS and&nbsp; sub-domains for specific needs is a common challenge. If you add to that the need for cross hosting DNS&nbsp; for sub domains across multiple IAAS makes it a little challenging for starters.<br /><br />In this post ,&nbsp; I will cover my example of hosting my primary DNS&nbsp; on AWS ,&nbsp; creating a DNS Zone for a sub domain in Azure and pointing a single A-Record on the subdomain to my <b>Concourse</b> instance running on Azure ( actually to the load-balancer in front of Concourse). Typically ,&nbsp; your primary Name servers will reside on the domain registrar you have used for your registration. a few examples are godaddy.com , domains.google.com , AWS route53&nbsp; and more. It is very possible you can create zone based delegation on the service you registered. But,&nbsp; when you use&nbsp; the Automation created as part of PCF-Pipelines ,&nbsp; there&nbsp; are some zone ( sub zones ) created by the pipelines on the DNS&nbsp; service&nbsp; on the IAAS&nbsp; you are installing. This has been the primary driver for me to write this post to explain cross service DNS delegation.<br /><div class="separator" style="clear: both; text-align: center;"><br /></div><ol><li>&nbsp;Lets create a new DNS&nbsp; Zone in Azure for the subdomain - az.clue2solve.com.&nbsp;</li><div class="separator" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/-YP_tMwEA-sA/W2CD50WNLVI/AAAAAAAAGI8/TIZK4ILshS4VGyk8Zo464jur_uj6zUclACLcBGAs/s1600/Azure-DNS-Zone%2BSample.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="830" data-original-width="1600" height="206" src="https://2.bp.blogspot.com/-YP_tMwEA-sA/W2CD50WNLVI/AAAAAAAAGI8/TIZK4ILshS4VGyk8Zo464jur_uj6zUclACLcBGAs/s400/Azure-DNS-Zone%2BSample.png" width="400" /></a></div>Here,&nbsp;you can see that I created not only a Zone, but a A-Record pointing to my load balancer for concourse as well. We also should copy the Value field in the NS-Record.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <li>Now I login to my AWS Route-53 Console where I registered my primary DNS. You could have done this in one of many Domain Name Registrars. All of them will allow you to do what I will explain here in this step.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</li><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://2.bp.blogspot.com/-fNPeTMlNdQk/W2CFS_2tUyI/AAAAAAAAGJU/7bTT44fs_M8dcDO_ptjNYU4cn21XKNEGQCLcBGAs/s1600/aws-route-53-1.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" data-original-height="787" data-original-width="1600" height="196" src="https://2.bp.blogspot.com/-fNPeTMlNdQk/W2CFS_2tUyI/AAAAAAAAGJU/7bTT44fs_M8dcDO_ptjNYU4cn21XKNEGQCLcBGAs/s400/aws-route-53-1.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Login to the AWS Console and Make your way to Route-53</td></tr></tbody></table><div class="separator" style="clear: both; text-align: center;"></div><ol></ol>Click on the Zones link to get you to the Zone Listing.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-RrnnsmAFBrQ/W2CFSgQ021I/AAAAAAAAGJI/y4FgdwYdcmIkJnBk6pvQz36Cthv4DJ7dgCLcBGAs/s1600/Route-53-2.png" imageanchor="1"><img border="0" data-original-height="1192" data-original-width="1318" height="360" src="https://4.bp.blogspot.com/-RrnnsmAFBrQ/W2CFSgQ021I/AAAAAAAAGJI/y4FgdwYdcmIkJnBk6pvQz36Cthv4DJ7dgCLcBGAs/s400/Route-53-2.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: left;">On the listing , click on the record for the primary domain.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<a href="https://4.bp.blogspot.com/-UyNzNs81Jdk/W2CFSpDDlaI/AAAAAAAAGJg/kGwRvsQwlGgPC1TG1xlkWzUcqabWhPNYwCPcBGAYYCw/s1600/Route-53-3.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="699" data-original-width="1600" height="172" src="https://4.bp.blogspot.com/-UyNzNs81Jdk/W2CFSpDDlaI/AAAAAAAAGJg/kGwRvsQwlGgPC1TG1xlkWzUcqabWhPNYwCPcBGAYYCw/s400/Route-53-3.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: left;">Now its time to link the Zone created in Azure to the primary domain. We do this by adding a NS-Record on the primary Zone and pointing the name servers to the list we copied from the Azure DNS Zone.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</div><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-PBJ8TFIVZ8I/W2CFSic3r_I/AAAAAAAAGJc/hnskpK8uShg0z079O-tt44yXq3jX80WIQCPcBGAYYCw/s1600/Route-53-4.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="1047" data-original-width="1600" height="261" src="https://4.bp.blogspot.com/-PBJ8TFIVZ8I/W2CFSic3r_I/AAAAAAAAGJc/hnskpK8uShg0z079O-tt44yXq3jX80WIQCPcBGAYYCw/s400/Route-53-4.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: left;">Here we go ,&nbsp; we have not successfully delegated our DNS for a subdomain.&nbsp;&nbsp;</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">As a test for this ,&nbsp; I have created an entry on my sub-domain in Azure-DNS called an A-Record. This is a pointer to a specific IP Address for a given domain name.&nbsp; In this case&nbsp; I want all requests&nbsp; for wings.az.clue2solve.com to go to the IP Address of the load-balancer in front of the concourse cluster we created&nbsp; per<a href="http://blog.clue2solve.io/2018/07/installing-pcf-2x-on-azure-using_31.html" target="_blank"> this blog post</a>.&nbsp;</div><div class="separator" style="clear: both; text-align: left;">You can extract the IP Address&nbsp; of the load-balancer&nbsp; with the sample&nbsp; command below on the bbl folder and add the A-Record on the zone ( sample Screen shot below).&nbsp;&nbsp;</div><div class="separator" style="clear: both; text-align: left;"><br /></div><pre>anandrao at Anands-MBP in ~/pivotal/repos/bbl-az/bbl</pre><pre><code>$ bbl lbs<br />Concourse LB: bbl-env-ontario-2018-07-31t05-15z-concourse-lb (20.189.131.186).</code></pre><pre><code><br /></code></pre><div class="separator" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/-dxFuNiXQWDE/W2yO8FON_wI/AAAAAAAAGNc/sN_sSAODT3MbIDXQvDjQET6_wncL5QFhwCLcBGAs/s1600/wings-dns.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="829" data-original-width="1600" height="206" src="https://2.bp.blogspot.com/-dxFuNiXQWDE/W2yO8FON_wI/AAAAAAAAGNc/sN_sSAODT3MbIDXQvDjQET6_wncL5QFhwCLcBGAs/s400/wings-dns.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">Open a browser and confirm that the link for the wings ( concourse on Azure )&nbsp; works.&nbsp;</div><div class="separator" style="clear: both; text-align: left;"><br /></div><pre><code><br /></code></pre><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-0X_C6P2-x54/W2CKbUSLhTI/AAAAAAAAGJo/KBVVIj4bcnYZgvuExHnfrii1n6SKruxagCLcBGAs/s1600/wings-home-page.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="1285" data-original-width="1600" height="320" src="https://1.bp.blogspot.com/-0X_C6P2-x54/W2CKbUSLhTI/AAAAAAAAGJo/KBVVIj4bcnYZgvuExHnfrii1n6SKruxagCLcBGAs/s400/wings-home-page.png" width="400" /></a></div><div class="separator" style="clear: both;"><br /></div><div class="separator" style="clear: both;"><br /></div><div class="separator" style="clear: both;">Quick links to the "The PCF on Azure" Blog Series :&nbsp;</div><ul><li><a href="http://blog.clue2solve.io/2018/07/installing-pcf-2x-on-azure-using.html">Installing PCF 2.X on Azure using Concourse - Part - 1 , Bosh Boot loader and bosh</a></li><li><a href="http://blog.clue2solve.io/2018/07/installing-pcf-2x-on-azure-using_31.html">Installing PCF 2.X on Azure using Concourse - Part - 2 , Concourse using bosh</a></li><li><a href="http://blog.clue2solve.io/2018/08/installing-pcf-2x-on-azure-using.html">Installing PCF 2.X on Azure using Concourse - Part - 3 , Installing Pivotal Cloud Foundry using a Pipeline</a></li><li><a href="http://blog.clue2solve.io/2018/07/domain-name-system-dns-delegation-with.html">Domain Name System (DNS) Delegation with Azure DNS Zones</a></li><li><a href="http://blog.clue2solve.io/2018/08/cleanup-azure-pcf-install-using-bbl.html">Cleanup Azure PCF install using BBL</a></li></ul><pre><code><br /></code></pre><div class="separator" style="clear: both; text-align: left;"></div><div class="separator" style="clear: both; text-align: left;"></div><div class="separator" style="clear: both; text-align: left;"></div></ol>